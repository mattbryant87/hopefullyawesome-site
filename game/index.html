<!doctype html>
<html>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JZRWFTHLVM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-JZRWFTHLVM');
</script>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Hopefully Flappy</title>
<style>
body{
  margin:0;
  background:#0b0d14;
  overflow:hidden;
  font-family:system-ui;
  color:white;
}

canvas{
  display:block;
  margin:0 auto;
  background:#111;
}

#score{
  position:fixed;
  top:20px;
  left:50%;
  transform:translateX(-50%);
  font-size:28px;
  font-weight:bold;
}
#overlay{
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  padding: 18px;
  background: rgba(0,0,0,0.55);
  backdrop-filter: blur(6px);
}

#card{
  width: min(420px, 92vw);
  border-radius: 18px;
  padding: 18px 16px 14px;
  border: 1px solid rgba(255,255,255,0.18);
  background: rgba(255,255,255,0.08);
  box-shadow: 0 18px 60px rgba(0,0,0,0.55);
  text-align: center;
}

#gameover{
  font-size: 22px;
  font-weight: 800;
  letter-spacing: 0.02em;
  margin-bottom: 6px;
}

#finalScore{
  font-size: 44px;
  font-weight: 900;
  margin: 6px 0 14px;
}

.actions{
  display: flex;
  gap: 10px;
  justify-content: center;
  flex-wrap: wrap;
}

#restart, #shareBtn{
  padding: 12px 16px;
  border: none;
  border-radius: 14px;
  font-weight: 800;
  cursor: pointer;
}

#restart{
  background: #01FFFF;
  color: #000;
}

#shareBtn{
  background: rgba(255,255,255,0.14);
  color: #fff;
  border: 1px solid rgba(255,255,255,0.22);
}

#shareHint{
  margin-top: 10px;
  font-size: 12px;
  color: rgba(255,255,255,0.70);
}

</style>
</head>
<body>

<div id="score">0</div>
<div id="overlay">
  <div id="card">
    <div id="gameover">Game Over</div>
    <div id="finalScore">Score: 0</div>

    <div class="actions">
      <button id="shareBtn">Share Score</button>
      <button id="restart">Play Again</button>
    </div>

    <div id="shareHint"></div>
  </div>
</div>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let gravity = 0.35;
let velocity = 0;
let birdY = canvas.height/2;
let birdX = 80;
let birdSize = 50;
let pipes = [];
let pipeWidth = 70;
let gap = 330;
let frame = 0;
let score = 0;
let gameOver = false;
let gameStarted = false;

function track(eventName, params = {}) {
  if (typeof gtag === "function") {
    gtag("event", eventName, params);
  }
}

const overlay = document.getElementById("overlay");
const finalScoreEl = document.getElementById("finalScore");
const shareBtn = document.getElementById("shareBtn");
const shareHint = document.getElementById("shareHint");

function showGameOver(){
  finalScoreEl.textContent = `Score: ${score}`;
  overlay.style.display = "flex";
  track("game_over", { game: "hopefully_flappy", score });
}

function hideGameOver(){
  overlay.style.display = "none";
  shareHint.textContent = "";
}
  
const PIPE_COLORS = ["#01FFFF", "#F71E99"]; // blue then pink
let pipeCount = 0;
  
const logoPaths = [
  "/assets/smallville-circle.png",
  "/assets/digimon-circle.png",
  "/assets/sailormoon-circle.PNG",   // keep the capital PNG
  "/assets/ha-main-logo-2026.png"
];

const logos = logoPaths.map(src => {
  const img = new Image();
  img.src = src;
  return img;
});

let currentLogo = logos[Math.floor(Math.random() * logos.length)];

function pickRandomLogo(){
  currentLogo = logos[Math.floor(Math.random() * logos.length)];
}

function spawnPipe(){
  let topHeight = Math.random() * (canvas.height - gap - 200) + 50;

  const color = PIPE_COLORS[pipeCount % PIPE_COLORS.length];
  pipeCount++;

  pipes.push({
    x: canvas.width,
    top: topHeight,
    bottom: canvas.height - topHeight - gap,
    color,
    passed: false
  });
}

function resetGame(){
  velocity = 0;
  birdY = canvas.height/2;
  pipes = [];
  frame = 0;
  score = 0;
  gameOver = false;
  document.getElementById("score").innerText = 0;
  pickRandomLogo();
  document.getElementById("restart").style.display="none";
  hideGameOver();
  gameStarted = false;
}

function update(){
  if(gameOver) return;

  velocity += gravity;
  birdY += velocity;

  if(frame % 120 === 0){
    spawnPipe();
  }

  pipes.forEach(pipe=>{
    pipe.x -= 2.2;

    if(
      birdX < pipe.x + pipeWidth &&
      birdX + birdSize > pipe.x &&
      (birdY < pipe.top || birdY + birdSize > pipe.top + gap)
    ){
      gameOver = true;
      showGameOver();
      document.getElementById("restart").style.display="block";
    }

    if(!pipe.passed && pipe.x + pipeWidth < birdX){
      pipe.passed = true;
      score++;
      document.getElementById("score").innerText = score;
    }
  });

  if(birdY + birdSize > canvas.height || birdY < 0){
    gameOver = true;
    showGameOver();
    document.getElementById("restart").style.display="block";
  }

  frame++;
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  pipes.forEach(pipe=>{
    ctx.fillStyle = pipe.color;
    ctx.fillRect(pipe.x, 0, pipeWidth, pipe.top);
    ctx.fillRect(pipe.x, pipe.top + gap, pipeWidth, pipe.bottom);
});

  ctx.drawImage(currentLogo, birdX, birdY, birdSize, birdSize);
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}

document.addEventListener("keydown", ()=>{
  if (!gameStarted) {
    gameStarted = true;
    track("game_start", { game: "hopefully_flappy" });
  }
  velocity = -9.5;
});

document.addEventListener("click", ()=>{
  if (!gameStarted) {
    gameStarted = true;
    track("game_start", { game: "hopefully_flappy" });
  }
  velocity = -9.5;
});

async function shareScreenshot(){
  shareHint.textContent = "Preparing screenshotâ€¦";

// Dark overlay
ctx.fillStyle = "rgba(0,0,0,0.65)";
ctx.fillRect(0, 0, canvas.width, canvas.height);

ctx.textAlign = "center";

const centerX = canvas.width / 2;
const centerY = canvas.height / 2;

// --- Dynamic sizing ---
const titleSize  = Math.min(canvas.width * 0.08, 40);
const scoreSize  = Math.min(canvas.width * 0.22, 120);
const pointsSize = Math.min(canvas.width * 0.07, 34);   // <-- POINTS sizing
const bodySize   = Math.min(canvas.width * 0.055, 22);
const urlSize    = Math.min(canvas.width * 0.05, 18);

const gap1 = 22;
const gap2 = 22;
const gap3 = 16;
const gap4 = 18;
const gap5 = 18;

// Badge radius based on score size
const badgeR = scoreSize * 0.62;

// Total vertical stack height (treat POINTS as part of the centered block)
const stackHeight =
  titleSize +
  gap1 +
  (badgeR * 2) +
  gap2 +
  pointsSize +
  gap3 +
  bodySize +
  gap4 +
  urlSize;

let currentY = centerY - stackHeight / 2;

// ---- TITLE ----
ctx.fillStyle = "#ffffff";
ctx.font = `bold ${titleSize}px system-ui`;
ctx.fillText("HOPEFULLY FLAPPY", centerX, currentY);
currentY += titleSize + gap1;

// ---- BADGE (glow + glass combo) ----
const badgeCenterY = currentY + badgeR;

// Outer glow (the punchy halo)
ctx.save();
ctx.shadowColor = "rgba(1,255,255,0.65)";
ctx.shadowBlur = 30;
ctx.fillStyle = "rgba(1,255,255,0.08)";
ctx.beginPath();
ctx.arc(centerX, badgeCenterY, badgeR + 2, 0, Math.PI * 2);
ctx.fill();
ctx.restore();

// Inner â€œglassâ€ radial gradient (this is the missing nice depth)
const g = ctx.createRadialGradient(
  centerX - badgeR * 0.25, badgeCenterY - badgeR * 0.35, badgeR * 0.15,
  centerX,                 badgeCenterY,                 badgeR
);
g.addColorStop(0, "rgba(255,255,255,0.18)");
g.addColorStop(0.45, "rgba(255,255,255,0.08)");
g.addColorStop(1, "rgba(0,0,0,0.35)");

ctx.fillStyle = g;
ctx.beginPath();
ctx.arc(centerX, badgeCenterY, badgeR, 0, Math.PI * 2);
ctx.fill();

// Ring
ctx.lineWidth = Math.max(5, badgeR * 0.08);
ctx.strokeStyle = "rgba(1,255,255,0.85)";
ctx.beginPath();
ctx.arc(centerX, badgeCenterY, badgeR, 0, Math.PI * 2);
ctx.stroke();

// ---- SCORE ----
ctx.fillStyle = "#01FFFF";
ctx.font = `bold ${scoreSize}px system-ui`;
ctx.textBaseline = "middle";
ctx.fillText(score, centerX, badgeCenterY);

// Move below badge
currentY += (badgeR * 2) + gap2;

// ---- POINTS! (now fully included in centered logic) ----
ctx.textBaseline = "alphabetic";
ctx.fillStyle = "#ffffff";
ctx.font = `bold ${pointsSize}px system-ui`;
ctx.fillText("POINTS!", centerX, currentY);
currentY += pointsSize + gap3;

// ---- CHALLENGE ----
ctx.fillStyle = "rgba(255,255,255,0.85)";
ctx.font = `${bodySize}px system-ui`;
ctx.fillText("Can you beat it?", centerX, currentY);
currentY += bodySize + gap4;

// ---- URL ----
ctx.fillStyle = "rgba(255,255,255,0.6)";
ctx.font = `${urlSize}px system-ui`;
ctx.fillText("hopefullyawesome.com/game", centerX, currentY);

// reset baseline just in case other drawing happens later
ctx.textBaseline = "alphabetic";
  // Make sure the last frame is drawn (usually already is)
  // draw();

  const blob = await new Promise(resolve => canvas.toBlob(resolve, "image/png"));

  if(!blob){
    shareHint.textContent = "Couldnâ€™t create screenshot. Try again.";
    return;
  }

  const file = new File([blob], `hopefully-flappy-score-${score}.png`, { type: "image/png" });

  const shareData = {
    title: "Hopefully Flappy",
    text: `I scored ${score} in Hopefully Flappy ðŸ˜…`,
    files: [file]
  };

  // Native share if supported
  if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
    try{
      await navigator.share(shareData);
      shareHint.textContent = "Shared!";
      return;
    }catch(e){
      // user canceled share â€“ no big deal
      shareHint.textContent = "Share canceled.";
      return;
    }
  }

  // Fallback: open the image in a new tab so you can Save/Share manually
  const url = URL.createObjectURL(blob);
  window.open(url, "_blank");
  shareHint.textContent = "Opened screenshot in a new tab (save/share it there).";
}

shareBtn.addEventListener("click", () => {
  track("share_score", { game: "hopefully_flappy", score });
  shareScreenshot();
});
  
document.getElementById("restart").onclick = resetGame;

loop();
</script>

</body>
</html>
